using Microsoft.Xrm.Sdk;
using Microsoft.Xrm.Sdk.Messages;
using Microsoft.Xrm.Tooling.Connector;
using System;

// Define the connection string for your Dynamics 365 instance
string connectionString = "AuthType=OAuth; " +
    "Username={username}; " +
    "Password={password}; " +
    "Url=https://org.crm.dynamics.com; " +
    "AppId={client_id}; " +
    "RedirectUri=app://unique-guid-here";

// Create a new instance of the CrmServiceClient class
var crmServiceClient = new CrmServiceClient(connectionString);

// Create a new instance of the RetrieveOrganizationsRequest message
var request = new RetrieveOrganizationsRequest();

// Set the flag to retrieve only the organization details
request.AccessType = EndpointAccessType.Default;

// Execute the request and retrieve the list of organizations
var response = (RetrieveOrganizationsResponse)crmServiceClient.Execute(request);

// Print the URL of each organization to the console
foreach (var organization in response.Details)
{
    Console.WriteLine($"Friendly Name: {organization.FriendlyName}");
    Console.WriteLine($"URL: {organization.Endpoints[EndpointType.WebApplication]}");
}
